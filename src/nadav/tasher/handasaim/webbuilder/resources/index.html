<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, minimal-ui"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
    <link rel="apple-touch-icon" href="web_res/icon_apple.png"/>
    <link rel="apple-touch-startup-image" href="web_res/loading_apple.png">
    <link rel="icon" href="web_res/icon.png"/>
    <title>H+</title>
    <style>
    .lessonView {
      background-color: #333;
      border-radius: 10px;
      width: inherit;
    }

    .lessonViewTime {
      font-size: 150%;
      text-align: center;
      padding: 4% 4%;
      font-style: italic;
    }

    .lessonViewText {
      font-size: 150%;
      text-align: right;
      padding: 8% 4%;
    }

    .hiddenView {
      visibility: hidden;
      display: none;
      height: 0;
    }

    .topBarIcon {
      height: inherit;
      vertical-align: middle;
      width: 8vh;
    }

    .classroomSchedule {
      /* display: flex; */
      /* font-size: 0; */
    }

    .switcherButton {
      background-color: #333;
      color: #FFF;
      font-size: 150%;
      text-align: center;
      border-radius: 1vh;
      padding: 4% 4%;
    }

    #aboutView {
      margin: 2vh;
      padding: 4vh;
    }

    #cornerTop {
      font-size: 140%;
    }

    #cornerBottom {
      font-size: 140%;

    }

    #topBar {
      vertical-align: top;
      border-radius: 10px;
      height: auto;
      width: inherit;
      /* position: absolute;
      vertical-align: top; */
    }

    #bottomBar {
      position: absolute;
      vertical-align: bottom;
      height: auto;
      width: auto;
      /* position: relative; */
    }

    #content {
      border-radius: 10px;
    }

    #classroomSwitcher {
      padding: 2vh;
    }

    #menuIcons {
      height: inherit;
      padding: 1vh;
    }

    #corner {
      height: 14vh;
      width: 14vh;
      border-radius: 14vh 0 0 0;
      -moz-border-radius: 14vh 0 0 0;
      -webkit-border-radius: 14vh 0 0 0;
      position: fixed;
      bottom: 0;
      right: 0;

    }

    #cornerContent {
      height: 11vh;
      width: 11vh;
      position: fixed;
      bottom: 0;
      right: 0;
    }

    right #cornerTop {
      font-size: 160%;
      text-align: center;
      vertical-align: middle;
    }

    #cornerBottom {
      font-size: 120%;
      text-align: center;
      vertical-align: middle;
    }

    html {
      height: auto;
      width: 100%;
      overflow-x: hidden;
    }

    body {
      background-repeat: no-repeat;
      -webkit-background-size: cover;
      -moz-background-size: cover;
      -o-background-size: cover;
      background-size: cover;
      min-height: 100vh;
    }

    p, a {
      font-family: Arial, ArialHebrew, sans-serif;
      color: #FFF;
      margin: 1vh;
    }

    </style>
    <script type="text/javascript">
    var schedule = {};
    var topBarColor = "#808080";
    var iconColor = "#dd8833";
    var topColor = "#00827E";
    var bottomColor = "#00649C";
    var classCookie = "class";

    function onPageLoad() {
      hideTopBar();
      setupColors();
      parseSchedule();
      setupSwitcher();
      setClassroom((getCookie(classCookie) != "" && getCookie(classCookie) != "undefined") ? getCookie(classCookie) : schedule.classrooms[0].n);
    }

    function setupColors() {
      setupTopBarColor();
      setupTopColor();
      setupCornerColor();
      setupBackground();
    }

    function setupTopBarColor() {
      document.getElementById("topBar").style.backgroundColor = topBarColor;
    }

    function setupTopColor() {<link rel="apple-touch-startup-image" href="/startup.png">

      var meta = document.createElement('meta');
      meta.name = "theme-color";
      meta.content = topColor;
      document.getElementsByTagName('head')[0].appendChild(meta);
    }

    function setupCornerColor() {
      document.getElementById("corner").style.backgroundColor = topColor + "80";
    }

    function setupSwitcher() {
      var switcher = document.getElementById("classroomSwitcher");
      for (var c = 0; c < schedule.classrooms.length; c++) {
        const name = schedule.classrooms[c].n;
        var grade = schedule.classrooms[c].g;
        var element = document.createElement("p");
        element.classList.add("switcherButton");
        element.onclick = function() {
          setClassroom(name);
          hideView(document.getElementById("classroomSwitcher"));
        };
        element.innerHTML = name;
        switcher.appendChild(element);
      }
    }

    function hideTopBar() {
      hideView(document.getElementById("topBar"));
    }

    function showTopBar() {
      showView(document.getElementById("topBar"));
    }

    function hideView(view) {
      view.style.visibility = "hidden";
      view.style.display = "none";
      view.style.height = "0";
    }

    function showView(view) {
      view.style.visibility = "visible";
      view.style.display = "block";
      view.style.height = "auto";
    }

    function setupBackground() {
      // document.body.style.backgroundColor = backColor;
      document.body.style.backgroundImage = 'linear-gradient(to bottom,' + topColor + ', ' + bottomColor + ')';
      document.body.style.backgroundColor = topColor;
    }

    function parseSchedule() {
      var content = document.getElementById("content");
      for (var c = 0; c < schedule.classrooms.length; c++) {
        var classroomView = document.createElement("div");
        classroomView.id = schedule.classrooms[c].n;
        classroomView.classList.add("classroomSchedule");
        for (var s = 0; s < schedule.classrooms[c].sjs.length; s++) {
          var lessonName = schedule.classrooms[c].sjs[s].n;
          var lessonHour = schedule.classrooms[c].sjs[s].h;
          if (lessonName.length > 0) {
            var lessonView = document.createElement("div");
            var top = document.createElement("p");
            var bottom = document.createElement("div");
            var time = document.createElement("p");

            time.classList.add("lessonViewTime");
            top.classList.add("lessonViewText");
            lessonView.classList.add("lessonView");
            hideView(bottom);

            top.innerHTML = "\u200F" + lessonHour + ". " + lessonName;
            time.innerHTML = minuteToTime(schedule.classrooms[c].sjs[s].bm) + " - " + minuteToTime(schedule.classrooms[c].sjs[s].em);

            lessonView.onclick = function() {
              console.log("FUN");
              if (isHidden(bottom)) {
                showView(bottom);
              } else {
                hideView(bottom);
              }
            };

            bottom.appendChild(time);
            lessonView.appendChild(top);
            lessonView.appendChild(bottom);
            classroomView.appendChild(lessonView);
          }
        }
        content.appendChild(classroomView);
        hideView(classroomView);
      }
    }

    function minuteToTime(minute) {
      var time = "";
      time += minute / 60;
      time += ":";
      time += (minute <= 9) ? "0" : "";
      time += minute % 60;
      return time;
    }

    function setClassroom(classroomName) {
      setCookie(classCookie, classroomName);
      document.getElementById("cornerTop").innerHTML = classroomName;
      document.getElementById("cornerBottom").innerHTML = schedule.day;
      for (var i = 0; i < document.getElementsByClassName("classroomSchedule").length; i++) {
        hideView(document.getElementsByClassName("classroomSchedule")[i]);
      }
      showView(document.getElementById(classroomName));
    }

    function isHidden(view) {
      return view.style.visibility == "hidden";
    }

    function toggleMenu() {
      if (isHidden(document.getElementById("topBar"))) {
        hideView(document.getElementById("aboutView"));
        hideView(document.getElementById("classroomSwitcher"));
        showTopBar();
      } else {
        hideTopBar();
      }
    }

    function toggleAbout() {
      if (isHidden(document.getElementById("aboutView"))) {
        showView(document.getElementById("aboutView"));
      } else {
        hideView(document.getElementById("aboutView"));
      }
    }

    function toggleSwitcher() {
      if (isHidden(document.getElementById("classroomSwitcher"))) {
        showView(document.getElementById("classroomSwitcher"));
      } else {
        hideView(document.getElementById("classroomSwitcher"));
      }
    }

    function setCookie(cname, cvalue) {
      cvalue = encodeURIComponent(cvalue);
      var exdays = 365;
      var d = new Date();
      d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
      var expires = "expires=" + d.toUTCString();
      document.cookie = cname + "=" + cvalue + ";" + expires + ";domain=" + window.location.hostname + ";path=/";
    }

    function getCookie(cname) {
      var name = cname + "=";
      var ca = document.cookie.split(';');
      for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
          return decodeURIComponent(c.substring(name.length, c.length));
        }
      }
      return "";
    }

    function refresh() {
      document.location.reload(true);
    }

    </script>
</head>

<body onload="onPageLoad()">
<center>
    <div id="topBar">
        <div id="menuIcons">
            <img src="web_res/class.svg" class="topBarIcon" onclick="toggleSwitcher()"/>
            <img src="web_res/icon.svg" class="topBarIcon" onclick="toggleAbout()"/>
            <img src="web_res/refresh.svg" class="topBarIcon" onclick="refresh()"/>
        </div>
        <div id="classroomSwitcher" class="hiddenView">
        </div>
        <div id="aboutView" class="hiddenView">
            <p>
                <b>Handasaim+ Web</b><br/>
                <i>Made by Nadav Tasher</i><br/>
                <i>webVersion</i><br/>
                <i>appCoreVersion</i><br/>
                <a id="installApp" href="web_res/app.mobileconfig">Install App</a>
            </p>
        </div>
    </div>
    <div id="popup">
    </div>
    <div id="content">
    </div>
    <div id="bottomBar">
        <div id="corner" onclick="toggleMenu()">
            <div id="cornerContent">
                <p id="cornerTop"/>
                <p id="cornerBottom"/>
            </div>
        </div>
    </div>
</center>
</body>

</html>
